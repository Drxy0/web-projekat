<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../Content/bootstrap.min.css">
    <script src="../Scripts/jquery-1.10.2.js"></script>
    <title>Rezencije</title>
    <style>
        .card {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

            .card .card-body {
                flex-grow: 1;
            }

        .card-footer {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: auto; /* Pushes the footer to the bottom */
            padding: 10px;
        }

            .card-footer .btn {
                margin: 0 10px; /* Adjust spacing between buttons */
            }
    </style>

</head>
<body>
    <nav id="nav" class="navbar navbar-fixed-top navbar-static-top" style="background-color: #242323;">
<<<<<<< HEAD:Web_PR106/admin-reviews.html
        <a href="Index.html" class="navbar-brand">
            Home
=======
        <a href="../Index.html" class="navbar-brand">
            Početna
>>>>>>> e061511 (Move html files to separate directory):Web_PR106/Pages/admin-reviews.html
        </a>
    </nav>

    <div class="container mt-5">
        <section id="airlineReviewsContainer">
        </section>
    </div>

    <script>

        $(document).ready(function () {
            getAirlines();
        });

        function getAirlines() {
            $.ajax({
                url: '../api/airlines',
                method: 'GET',
                contentType: 'application/json',
                success: function (data) {
                    var container = $('#airlineReviewsContainer');
                    container.empty();

                    data.forEach(function (airline) {
                        var header = `<h2>${airline.Name}</h2>`;
                        container.append(header);

                        var row = $('<div class="row"></div>');
                        airline.Reviews.forEach(function (review) {
                            var card = `
                                <div class="col-md-4 mb-4">
                                    <div class="card">
                                        ${review.Picture ? `<img class="card-img-top" src="${review.Picture}">` : ''}
                                        <div class="card-body">
                                            <h5 class="card-title">${review.Title}</h5>
                                            <p class="card-text">${review.Description}</p>
                                        </div>
                                        <div class="card-footer">
                                            <a class="btn btn-success approve" onclick="approveReview('${review.Id}', this)">Odobri</a>
                                            <a class="btn btn-danger reject" onclick="rejectReview('${review.Id}', this)">Odbij</a>
                                        </div>
                                    </div>
                                </div>
                            `;
                            row.append(card);

                            if (review.Status === 1) {
                                approveUpdateUI(row.find('.approve:last'));
                            }
                            else if (review.Status === 2) {
                                rejectUpdateUI(row.find('.reject:last'));
                            }
                        });
                        container.append(row);
                    });

                },
                error: function (xhr, status, error) {
                    console.error('Error:', status, error);
                }
            });
        }

        function approveReview(Id, button) {
            $.ajax({
                url: `../api/review/approve/${Id}`,
                method: 'POST',
                contentType: 'application/json',
                success: function (response) {
                    approveUpdateUI(button)
                },
                error: function (xhr, status, error) {
                }
            });
        }

        function rejectReview(Id, button) {
            $.ajax({
                url: `../api/review/reject/${Id}`,
                method: 'POST',
                contentType: 'application/json',
                success: function (response) {
                    rejectUpdateUI(button);
                },
                error: function (xhr, status, error) {
                    console.error('Error rejecting review:', status, error);
                }
            });
        }

        function approveUpdateUI(button) {
            $(button).text('Odobrena').removeClass('btn-success').addClass('btn-secondary').removeAttr('onclick');
            $(button).siblings('.reject').attr('hidden', true).removeClass('btn-danger').addClass('btn-secondary');
        }

        function rejectUpdateUI(button) {
            $(button).text('Odbijena').removeClass('btn-danger').addClass('btn-secondary').removeAttr('onclick');
            $(button).siblings('.approve').attr('hidden', true).removeClass('btn-success').addClass('btn-secondary');
        }

    </script>
</body>
</html>
